## Async Defer

> script 태그 엘리먼트를 공부하던중 이건 나중에 까먹을것 같아서 TIL에 정리한다.

`async`, `defer` 스크립트를 논-블로킹으로 읽어들이고 싶을 때 사용하는 불리언 속성들이다.
스크립트 엘리먼트는 default로 HTML parser의 동작을 중단하고 스크립트를 다운로드하는 블로킹 모드로 동작한다.

이 방법은 여러 스크립트 엘리먼트가 있을 경우에도 실행 순서를 보장할 수 있다는 장점은 있지만 **(`</body>` 앞에 작성했을때의 경우)** , 스크립트 파일을 다운로드하는 동안에 파싱이 중단되므로 웹 페이지의 성능을 저하시킬 수 있다.

![](https://taegon.kim/wp-content/uploads/2018/04/image-2.png)
<small>ㄴ 각각의 방법의 프로세스 시각화</small>

그런데 `async` 또는 `defer` 속성을 사용하면 다운로드는 백그라운드에서 진행되고 스크립트를 실행하는 동안만 HTML 파싱을 중단하는 소위 논-블로킹 모드로 동작한다. 따라서 웹 페이지는 두 속성을 사용하지 않았을 때보다 더 빠르게 표시될 수 있다.

두 속성에는 두 가지 차이가 있다. 하나는 `defer` 는 다운로드가 먼저 끝나더라도 파싱이 완료될 때까지 기다렸다가 스크립트를 실행하지만, `async` 는 다운로드가 끝나면 바로 스크립트를 실행한다는 것이다.

나머지 하나는 `defer` 는 두 속성 중 아무 것도 사용하지 않았을 때와 마찬가지로 실행 순서를 보장해주지만 **(`</body>` 앞에 작성했을때의 경우가 아니면 `async`의 문제점이 일어날 수 있다.)** , `async`는 다운로드 받은 순서대로 실행되기 때문에 실행 순서가 스크립트 엘리먼트의 출현 순서와 다를 수 있다는 것이다.

### 내용 더하기

> 구식 브라우저에서는 `defer` 만 지원하기도 해서 다음과 같이 두 속성을 모두 적어두기도 한다.

```html
<script defer async src="async.js"></script>
```

위 예제와 같이 작성하면 async를 지원하는 최신 브라우저에서는 async가 defer에 우선하기 때문에 async의 특성을 따르고 구식 브라우저에서는 defer의 특성을 따른다.

모듈 스크립트에는 async만 사용할 수 있는데, async가 설정되어 있으면 관련 모듈의 다운로드가 끝난 후 바로 스크립트를 실행하지만 default인 경우 마치 `defer` 처럼 웹 페이지 파싱이 끝날 때까지 기다렸다가 실행한다(위 이미지 참조).
